const fetch = require('node-fetch');

async function fetchRequest(url, options = {}) {
    const { getHeaders = false, json = false, sendTime = false } = options;
    console.log(`Fetch URL: ${url}`);

    // Check if URL starts with http:// or https://
    if (!url.startsWith('https://') && !url.startsWith('http://')) {
        throw new Error('No schema');
    }

    try {
        const startTime = Date.now(); // Get the current timestamp in milliseconds
        const response = await fetch(url, options);

        // Calculate the response time if requested
        const responseTime = sendTime ? Date.now() - startTime : undefined;
        console.log(sendTime ? `Response time: ${responseTime} milliseconds` : '');

        // Send headers if requested
        if (getHeaders) {
            let headersObject = {};
            response.headers.forEach((value, key) => {
                headersObject[key] = value;
            });
            console.log(`Headers: ${(Object.keys(headersObject)).join(', ')}`);
            return { headers : headersObject, ...(sendTime && { responseTime }) };
        }

        const responseData = json ? await response.json() : await response.text();

        return { data: await responseData, ...(sendTime && { responseTime }) };
    } catch (error) {
        throw new Error(`Fetch request failed: ${error.message}`);
    }
}

module.exports = {
    fetchRequest
};
