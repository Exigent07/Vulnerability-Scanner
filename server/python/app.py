from flask import Flask, request, jsonify
from utils.requestsUtils import send_request

app = Flask(__name__)

@app.route('/request', methods=['POST'])
def receive_json():
    try:
        print(request.url)
        json_data = request.json
        print('Received JSON data:', json_data)

        if not isinstance(json_data, dict):
            raise ValueError('Invalid JSON data format. Expected a JSON object.')

        url = json_data.get('url')
        method = json_data.get('method', 'GET')
        data = json_data.get('data')
        headers = json_data.get('headers')

        print('URL:', url)
        print('Method:', method)
        print('Data:', data)
        print('Headers:', headers)

        response_data = send_request(url, data=data, method=method, headers=headers)

        return jsonify(response_data)
    except Exception as e:
        print(f'Error processing JSON data: {e}')
        return jsonify({'error': str(e)}), 500

# @app.route('/idor', methods=['POST'])
# def find_idor():


if __name__ == '__main__':
    app.run(debug=True, port=1338)
