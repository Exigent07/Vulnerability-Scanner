import requests 
import json
import colorama
import argparse

colorama.init()
def send_request(url, data=None, headers=None, target='http://example.com', scan_type='scan', api_key='test', cookie=None):
    try:
        print('Sending request to:', url + scan_type)
        print('API Key:', api_key)
        if (not headers):
            headers = {
                'X-API-KEY': api_key,
            }
        else:
            headers['X-API-KEY'] = api_key
        
        print(f"Headers: {headers}")
        response = requests.post(url + scan_type, data=data, headers=headers, cookies=cookie)
        print( { "data": response.text } )
        return { "data": response.text } if response.ok else None
    except Exception as e:
        print(f'Error sending request: {e}')
        return None

def print_structure(response, colorize=True):
    if colorize:
        print_color = colorama.Fore.GREEN
    else:
        print_color = ""

    try:
        parsed_response = json.loads(response)
        formatted_response = json.dumps(parsed_response, indent=4, sort_keys=True)
        print(f"{print_color}{formatted_response}{colorama.Style.RESET_ALL}")
    except json.JSONDecodeError:
        print("Failed to parse response. Response is not in JSON format.")

def import_json_file(file_path):
    try:
        with open(file_path, 'r') as file:
            return file.read()
    except FileNotFoundError:
        print(f"File '{file_path}' not found.")
        return None

def main():
    parser = argparse.ArgumentParser(description='Send request to API and print JSON response structure with optional colorization.')
    parser.add_argument('--url', required=True, help='API base URL')
    parser.add_argument('--data', type=json.loads, default=None, help='JSON data for the request')
    parser.add_argument('--headers', type=json.loads, default=None, help='JSON headers for the request')
    parser.add_argument('--scan_type', default='scan', help='Type of scan (default: full)')
    parser.add_argument('--api_key', required=True, help='API key')
    parser.add_argument('--target_url', default='http://example.com', help='Target URL (default: http://example.com)')
    parser.add_argument('--file', help='Path to JSON file to import and print its structure')
    parser.add_argument('--colorize', action='store_true', help='Colorize the output (default: True)')
    args = parser.parse_args()

    send_request(url=args.url, data=args.data, headers=args.headers, scan_type=args.scan_type, api_key=args.api_key, target=args.target_url)
    print('done')

    if args.file:
        response_from_file = import_json_file(args.file)
        if response_from_file:
            print_structure(response_from_file, args.colorize)

if __name__ == "__main__":
    main()
